# workflow åç§°
name: GitHub Actions Demo
# runåç§°
run-name: ${{ github.actor }} is testing out GitHub Actions ğŸš€
# è§¦å‘æ¡ä»¶
on: [push]
# é€šè¿‡è®¾ç½® schedule èƒ½å®šæ—¶è§¦å‘ workflow, ä»¥UTCæ—¶é—´ä¸ºå‡†
# UTC(ä¸–ç•Œåè°ƒæ—¶)+8 -> CST(ä¸­å›½æ ‡å‡†æ—¶é—´, åŒ—äº¬æ—¶é—´) https://datetime360.com/cn/utc-cst-china-time/
# https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule
# schedule:
  # å¯ä»¥å†™å¤šä¸ª cron, å•ä¸ªcron å†…ä¹Ÿå¯å†™å¤šä¸ªæ—¶é—´, å¦‚ '30 18,6 * * *'è¡¨ç¤º UTC18:30 æˆ– UTC6:30
  # cron å†…æ•°å€¼ä»å·¦è‡³å³ä¾æ¬¡ä¸º
  # Minute [0,59]
  # Hour [0,23]
  # Day of the month [1,31]
  # Month of the year [1,12]
  # Day of the week ([0,6] with 0=Sunday)
  # è¯¦è§ https://pubs.opengroup.org/onlinepubs/9699919799/utilities/crontab.html#tag_20_25_07
  # - cron: '30 18 * * *'

# ç¯å¢ƒå˜é‡, workflowçº§åˆ«çš„å…¨å±€å˜é‡
env:
  GLOBAL_VAR_NAME: "global var name"
  
# ä¸€ä¸ª workflow ç”±ä¸€ä¸ªæˆ–å¤šä¸ª job ç»„æˆ, jobs å¹¶è¡Œè¿è¡Œ
# å¯é€šè¿‡ç»™ job è®¾ç½® needs å°† job ç©¿è¡Œè¿è¡Œ
# ä¾‹å¦‚ needs: job1 è¡¨æ˜å½“å‰ job éœ€è¦åœ¨ job1 ä¹‹åè¿è¡Œ, needs: [job1, job2] è¡¨ç¤ºéœ€è¦åœ¨ job1 å’Œ job2 ä¹‹åè¿è¡Œ. å…¶ä¸­ job1, job2 æ˜¯å…¶ä»– job çš„ ID 
jobs:
  # job ID, å½“å‰ job çš„å”¯ä¸€æ ‡è¯†, å¯ç”¨äºæµç¨‹æ§åˆ¶
  job_0:
    # job åç§°
    name: "Job 0"
    # è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest
    # ç¯å¢ƒå˜é‡, jobçº§åˆ«çš„å±€éƒ¨å˜é‡
    env:
      LOCAL_VAR_NAME: "local var name"
    # å½“å‰jobçš„è¾“å‡º, åœ¨å…¶ä»–jobä¸­å¯é€šè¿‡ ${{needs.<job_id>.outputs.<output_name>}} è·å–
    outputs:
      # æŠŠå½“å‰jobæ¯ä¸€æ­¥çš„è¾“å‡ºæ˜ ä¸ºåˆ°å½“å‰jobçš„æ•´ä½“è¾“å‡º
      output1: ${{ steps.step1.outputs.test }}
      output2: ${{ steps.step2.outputs.demo }}
    steps:
      # æ¯ä¸€ä¸ªstepéƒ½å¯ä»¥è®¾ç½®id, ä»¥ä¾¿äºè·å–å½“å‰æ­¥éª¤çš„è¾“å‡º
      - id: step1
        run: echo "test=hello" >> "$GITHUB_OUTPUT"
      # å°†å½“å‰ step çš„æ•°æ®è¾“å‡º 
      - id: step2
        run: echo "demo=job_0's step2's output" >> "$GITHUB_OUTPUT"
      # ç¯å¢ƒå˜é‡, æŒ‰ä½œç”¨åŸŸå¯åˆ†ä¸º workflowçº§, jobçº§, stepçº§
      - run: echo "åœ¨job0ä¸­è·å–å…¨å±€ç¯å¢ƒå˜é‡ $GLOBAL_VAR_NAME, å±€éƒ¨ç¯å¢ƒå˜é‡ $LOCAL_VAR_NAME"
      # å½“å‰ job çš„è¿è¡ŒçŠ¶æ€
      - run: echo "This job's status is ${{ job.status }}."
  job_id_0:
    name: "Job name"
    runs-on: ubuntu-latest
    needs: job_0
    steps:
      - run: echo "1. job's status ${{ job.status }}."
      - run: echo "2. å…¨å±€ç¯å¢ƒå˜é‡ $GLOBAL_VAR_NAME, è·å–ä¸åˆ°ä¸Šä¸€ä¸ªjobçš„å±€éƒ¨ç¯å¢ƒå˜é‡ $LOCAL_VAR_NAME"
      # stepçº§åˆ«çš„ç¯å¢ƒå˜é‡, å°†ä¸Šä¸€ä¸ªjobçš„è¾“å‡ºmapåˆ°ç¯å¢ƒå˜é‡ä¸Šä½¿ç”¨
      - env:
          OUTPUT1: ${{needs.job_0.outputs.output1}}
          OUTPUT2: ${{needs.job_0.outputs.output2}}
        run: echo "2. $OUTPUT1 $OUTPUT2"
      - run: echo "3. job's status ${{ job.status }}."
#      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
#      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
#      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
#      - name: Check out repository code
#        uses: actions/checkout@v3
#      - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
#      - run: echo "ğŸ–¥ï¸ The workflow is now ready to test your code on the runner."
#      - name: List files in the repository
#        run: |
#          ls ${{ github.workspace }}
#      - run: echo "ğŸ This job's status is ${{ job.status }}."
